<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Cairo',sans-serif;}

body{
  background:linear-gradient(to bottom,#0a0a0a,#111,#1a1a1a,#222);
  min-height:100vh;
  color:white;
  padding:15px;
}

/* Ø¹Ù†ÙˆØ§Ù† */
.page-title{
  text-align:center;
  font-size:32px;
  font-weight:800;
  margin:20px 0 30px;
}

/* Ø§Ù„ÙƒØ±ÙˆØª */
.box{
  background:rgba(255,255,255,0.07);
  padding:20px;
  border-radius:16px;
  backdrop-filter:blur(6px);
  box-shadow:0 6px 18px rgba(0,0,0,0.45);
  margin-bottom:25px;
  max-width:650px;
  margin-left:auto;
  margin-right:auto;
}

.box h3{
  font-size:22px;
  font-weight:800;
  margin-bottom:12px;
}

/* Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª */
input, textarea, select {
  width:100%;
  background:#00000040;
  color:white;
  padding:12px;
  border-radius:10px;
  border:1px solid #555;
  margin-top:6px;
  margin-bottom:12px;
  font-size:16px;
}

input:focus, textarea:focus, select:focus {
  border-color:#1f6feb;
  background:#1c2330;
}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.btn{
  width:100%;
  padding:14px;
  font-size:17px;
  border-radius:12px;
  font-weight:800;
  cursor:pointer;
  border:none;
  background:#1f6feb;
  color:white;
  transition:0.2s;
}

.btn:hover{
  background:#2f82ff;
}

.btn.red{
  background:#d40000;
}
.btn.red:hover{
  background:#ff1a1a;
}

/* ÙƒÙ„ ØªÙ†Ø¨ÙŠÙ‡ */
.item{
  background:rgba(255,255,255,0.06);
  padding:18px;
  border-radius:14px;
  margin-bottom:15px;
  border-right:6px solid #1f6feb;
  box-shadow:0 4px 10px rgba(0,0,0,0.35);
}

.item h3{
  color:#1f82ff;
  margin-bottom:6px;
}

.item p{
  margin-bottom:8px;
}

/* Ø£Ø²Ø±Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
.item .btn{
  margin-top:8px;
}

/* Ù„Ù„Ù‡ÙˆØ§ØªÙ */
@media(max-width:600px){
  .page-title{font-size:26px;}
  .box{padding:18px;}
}
</style>
</head>

<body>

<h1 class="page-title">ğŸ“¢ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h1>

<!-- Ø¥Ø¶Ø§ÙØ© -->
<div class="box">
  <h3>â• Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø¨ÙŠÙ‡ Ø¬Ø¯ÙŠØ¯</h3>

  <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡:</label>
  <input id="title">

  <label>Ø§Ù„Ù†Øµ:</label>
  <textarea id="text" rows="3"></textarea>

  <label>Ø§Ù„Ø­Ø§Ù„Ø©:</label>
  <select id="active">
    <option value="true">ğŸ”µ Ù†Ø´Ø·</option>
    <option value="false">âš« ØºÙŠØ± Ù†Ø´Ø·</option>
  </select>

  <button class="btn" id="addBtn">Ø¥Ø¶Ø§ÙØ©</button>
</div>

<!-- Ù‚Ø§Ø¦Ù…Ø© -->
<div class="box">
  <h3>ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3>
  <div id="alerts-list">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
</div>

<!-- JS -->
<script type="module">
import { auth, db } from "./firebase.js";
import {
  collection, addDoc, getDocs,
  deleteDoc, updateDoc, doc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

// Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
auth.onAuthStateChanged(u => {
  if (!u) location.href = "login.html";
});

// Ø¥Ø¶Ø§ÙØ©
document.getElementById("addBtn").onclick = async () => {
  const title = titleInput.value.trim();
  const text  = textInput.value.trim();
  const active = activeSelect.value === "true";

  if (!title || !text){
    alert("Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
    return;
  }

  await addDoc(collection(db, "alerts"), {
    title, text, active,
    created_at: serverTimestamp()
  });

  alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ”");
  loadAlerts();
};

const titleInput = document.getElementById("title");
const textInput  = document.getElementById("text");
const activeSelect = document.getElementById("active");

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
async function loadAlerts(){
  const box = document.getElementById("alerts-list");
  box.innerHTML = "Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

  const snap = await getDocs(collection(db,"alerts"));

  let html = "";
  snap.forEach(docu => {
    const a = docu.data();
    html += `
      <div class="item">
        <h3>${a.title}</h3>
        <p>${a.text}</p>
        <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${a.active ? "ğŸ”µ Ù†Ø´Ø·" : "âš« ØºÙŠØ± Ù†Ø´Ø·"}</p>

        <button class="btn" onclick="editAlert('${docu.id}','${a.title}','${a.text}',${a.active})">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn red" onclick="deleteAlert('${docu.id}')">Ø­Ø°Ù</button>
      </div>
    `;
  });

  box.innerHTML = html || "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>";
}

loadAlerts();

// Ø­Ø°Ù
window.deleteAlert = async (id)=>{
  if (!confirm("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ")) return;
  await deleteDoc(doc(db,"alerts",id));
  loadAlerts();
};

// ØªØ¹Ø¯ÙŠÙ„
window.editAlert = async (id,title,text,active)=>{
  const nt = prompt("Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:",title);
  if (!nt) return;

  const newText = prompt("Ø§Ù„Ù†Øµ:",text);
  if(!newText) return;

  const st = confirm("Ø¬Ø¹Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù†Ø´Ø·ØŸ");

  await updateDoc(doc(db,"alerts",id),{
    title:nt,text:newText,active:st
  });

  alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ”");
  loadAlerts();
};
</script>

</body>
</html>
