<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</title>
<link rel="stylesheet" href="style.css">
<script type="module" src="firebase.js"></script>

<style>
body { font-family: 'Cairo', sans-serif; background:#f5f5f5; padding:20px; }
.box {
  background:white; padding:20px; border-radius:12px;
  box-shadow:0 4px 12px #0001; margin-bottom:25px; max-width:700px;
}
.btn{padding:10px 20px;background:#0066ff;color:white;border-radius:8px;cursor:pointer;}
.btn.red{background:#d40000}
.item{background:#fff;padding:15px;margin:12px 0;border-radius:8px;border-left:5px solid #0066ff;}
</style>
</head>

<body>

<h2>ğŸ“¢ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h2>
<p id="status" style="color:red;font-weight:bold;"></p>

<div class="box">
  <h3>â• Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø¨ÙŠÙ‡ Ø¬Ø¯ÙŠØ¯</h3>

  <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡:</label>
  <input id="title" style="width:100%;padding:10px;margin:6px 0;border-radius:6px;border:1px solid #ccc">

  <label>Ø§Ù„Ù†Øµ:</label>
  <textarea id="text" style="width:100%;padding:10px;height:80px;border-radius:6px;border:1px solid #ccc"></textarea>

  <label>Ø§Ù„Ø­Ø§Ù„Ø©:</label>
  <select id="active" style="padding:10px;width:100%;border-radius:6px;">
    <option value="true">ğŸ”µ Ù†Ø´Ø·</option>
    <option value="false">âš« ØºÙŠØ± Ù†Ø´Ø·</option>
  </select>

  <br><br>
  <button class="btn" id="addBtn">Ø¥Ø¶Ø§ÙØ©</button>
</div>

<div class="box">
  <h3>ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3>
  <div id="alerts-list">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
</div>

<script type="module">
import { auth } from "./firebase.js";
import {
  db,
} from "./firebase.js";
import {
  collection, addDoc, getDocs, deleteDoc,
  updateDoc, doc, serverTimestamp
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

// =======================
// Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
// =======================
auth.onAuthStateChanged(user => {
  if (!user) {
    alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…");
    location.href = "login.html";
  }
});

// =======================
// Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø¨ÙŠÙ‡
// =======================
document.getElementById("addBtn").onclick = async () => {
  const title = document.getElementById("title").value.trim();
  const text  = document.getElementById("text").value.trim();
  const active = document.getElementById("active").value === "true";

  if (!title || !text) {
    alert("Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
    return;
  }

  await addDoc(collection(db, "alerts"), {
    title,
    text,
    active,
    "ÙˆÙ‚Øª Ø§Ù„Ø§Ø¶Ø§ÙÙ‡": serverTimestamp()
  });

  alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ”");
  loadAlerts();
};

// =======================
// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
// =======================
async function loadAlerts() {
  const box = document.getElementById("alerts-list");
  box.innerHTML = "Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

  const snap = await getDocs(collection(db, "alerts"));

  let html = "";
  snap.forEach(d => {
    const a = d.data();
    html += `
      <div class="item">
        <h3>${a.title}</h3>
        <p>${a.text}</p>

        <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${a.active ? "ğŸ”µ Ù†Ø´Ø·" : "âš« ØºÙŠØ± Ù†Ø´Ø·"}</p>

        <button class="btn" onclick="editAlert('${d.id}','${a.title}','${a.text}',${a.active})">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn red" onclick="deleteAlert('${d.id}')">Ø­Ø°Ù</button>
      </div>
    `;
  });

  box.innerHTML = html || "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>";
}

loadAlerts();

// =======================
// Ø­Ø°Ù ØªÙ†Ø¨ÙŠÙ‡
// =======================
window.deleteAlert = async (id) => {
  if (!confirm("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ")) return;
  await deleteDoc(doc(db, "alerts", id));
  loadAlerts();
};

// =======================
// ØªØ¹Ø¯ÙŠÙ„ ØªÙ†Ø¨ÙŠÙ‡
// =======================
window.editAlert = async (id, t, c, active) => {
  const title = prompt("Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡:", t);
  if (!title) return;

  const text = prompt("Ø§Ù„Ù†Øµ:", c);
  if (!text) return;

  const st = confirm("Ø¬Ø¹Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù†Ø´Ø·ØŸ");

  await updateDoc(doc(db, "alerts", id), {
    title,
    text,
    active: st
  });

  alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ”");
  loadAlerts();
};
</script>

</body>
</html>
