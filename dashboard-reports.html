<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“‹ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Cairo',sans-serif;}

body{
  background:linear-gradient(to bottom,#0a0a0a,#111,#1a1a1a,#222);
  min-height:100vh;
  color:white;
  padding:15px;
}

/* ===== Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ===== */
h2{
  text-align:center;
  margin-bottom:20px;
  font-size:28px;
  font-weight:800;
}

/* ===== Ø§Ù„ÙƒØ±ÙˆØª ===== */
.card{
  background:rgba(255,255,255,0.08);
  padding:20px;
  border-radius:16px;
  margin-bottom:18px;
  box-shadow:0 6px 18px rgba(0,0,0,0.45);
  backdrop-filter:blur(5px);
  transition:.25s;
}

.card:hover{
  background:rgba(255,255,255,0.12);
  transform:scale(1.02);
}

.card strong{
  color:#4db8ff;
  font-size:17px;
}

/* ===== Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ===== */
.input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:none;
  background:#ffffff22;
  color:white;
  margin-top:8px;
  margin-bottom:10px;
  font-size:16px;
}

/* ===== Ø§Ù„Ø£Ø²Ø±Ø§Ø± ===== */
.btn{
  padding:12px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  width:100%;
  font-size:17px;
  font-weight:700;
  margin-top:4px;
  transition:.2s;
}

.save{background:#28a745;}
.save:hover{background:#42c85a;}

.delete{background:#dc3545;}
.delete:hover{background:#ff5566;}
</style>
</head>

<body>

<h2>ğŸ“‹ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</h2>
<div id="list">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

<script type="module">
import { db, auth } from "./firebase.js";
import { 
  collection, doc, updateDoc, deleteDoc,
  onSnapshot, query, orderBy
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

import { onAuthStateChanged } 
  from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";


// Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
onAuthStateChanged(auth, user => {
  if (!user) window.location.href = "login.html";
});


// Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª
const list = document.getElementById("list");
const q = query(collection(db, "reports"), orderBy("created_at", "desc"));

onSnapshot(q, (snap) => {
  if (snap.empty) {
    list.innerHTML = "<p style='text-align:center;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù„Ø§ØºØ§Øª.</p>";
    return;
  }

  let html = "";

  snap.forEach(docSnap => {
    const r = docSnap.data();
    const id = docSnap.id;

    html += `
      <div class="card">
        <strong>Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù„Ø§Øº:</strong> ${r.type ?? ""}<br>
        <strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${r.name ?? ""}<br>
        <strong>Ø§Ù„Ø­ÙŠ:</strong> ${r.location ?? ""}<br>
        <strong>Ø§Ù„ØªÙØ§ØµÙŠÙ„:</strong> ${r.details ?? ""}<br>
        <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${r.status ?? "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©"}<br>

        <hr style="opacity:0.2; margin:10px 0;">

        <label>âœ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ù„Ø§Øº:</label>
        <textarea id="reply-${id}" class="input" rows="3">${r.reply ?? ""}</textarea>

        <label>âš™ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©:</label>
        <select id="status-${id}" class="input">
          <option ${r.status=="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©"?"selected":""}>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
          <option ${r.status=="Ø¬Ø§Ø±Ù Ø§Ù„Ø­Ù„"?"selected":""}>Ø¬Ø§Ø±Ù Ø§Ù„Ø­Ù„</option>
          <option ${r.status=="ØªÙ… Ø§Ù„Ø­Ù„"?"selected":""}>ØªÙ… Ø§Ù„Ø­Ù„</option>
        </select>

        <button class="btn save" onclick="saveUpdate('${id}')">ğŸ’¾ Ø­ÙØ¸</button>
        <button class="btn delete" onclick="removeReport('${id}')">ğŸ—‘ Ø­Ø°Ù</button>
      </div>
    `;
  });

  list.innerHTML = html;
});


// Ø­ÙØ¸ Ø§Ù„Ø±Ø¯ + ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©
window.saveUpdate = async (id) => {
  const reply = document.getElementById(`reply-${id}`).value;
  const status = document.getElementById(`status-${id}`).value;

  await updateDoc(doc(db, "reports", id), { reply, status });
  alert("âœ” ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ù„Ø§Øº");
};


// Ø­Ø°Ù Ø§Ù„Ø¨Ù„Ø§Øº
window.removeReport = async (id) => {
  if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")) {
    await deleteDoc(doc(db, "reports", id));
    alert("âœ” ØªÙ… Ø§Ù„Ø­Ø°Ù");
  }
};
</script>

</body>
</html>
