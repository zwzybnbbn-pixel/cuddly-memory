<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>سبب الانقطاع – كهرباء عتق</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Cairo',sans-serif;}

/* نفس خلفية الرئيسية */
body{
  background:linear-gradient(to bottom,#0a0a0a,#111,#1a1a1a,#222);
  min-height:100vh;
  color:white;
  padding:15px;
}

/* عنوان الصفحة */
header{
  text-align:center;
  margin-bottom:25px;
}

header h2{
  font-size:32px;
  font-weight:800;
}

/* صندوق عرض الأسباب */
#reason-box{
  display:flex;
  flex-direction:column;
  gap:16px;
  max-width:650px;
  margin:0 auto;
}

/* نفس تصميم الكروت في الرئيسية */
.item{
  background:rgba(255,255,255,0.07);
  padding:18px;
  border-radius:16px;
  backdrop-filter:blur(5px);
  box-shadow:0 6px 18px rgba(0,0,0,0.45);
  transition:0.25s;
}

.item:hover{
  background:rgba(255,255,255,0.12);
  transform:scale(1.03);
}

.item p{
  font-size:18px;
  margin-bottom:8px;
}

.item small{
  font-size:14px;
  opacity:.8;
}

/* زر العودة */
.back-btn{
  display:block;
  width:100%;
  max-width:250px;
  margin:25px auto;
  background:#ffffff33;
  color:white;
  text-align:center;
  padding:12px;
  font-size:18px;
  text-decoration:none;
  font-weight:700;
  border-radius:14px;
  transition:0.2s;
}

.back-btn:hover{
  background:white;
  color:black;
}

</style>
</head>

<body>

<header>
  <h2>⚡ أسباب الانقطاع</h2>
</header>

<div id="reason-box">
  <p style="text-align:center;">جاري التحميل...</p>
</div>

<a href="index.html" class="back-btn">⬅ رجوع للرئيسية</a>

<script type="module">
import { db } from "./firebase.js";
import { collection, getDocs, query, orderBy } 
  from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const box = document.getElementById("reason-box");

function formatDateMaybe(ts) {
  if (!ts) return "—";
  if (typeof ts.toDate === "function") {
    return ts.toDate().toLocaleString("ar-EG", {
      year: "numeric", month: "long", day: "numeric",
      hour: "2-digit", minute: "2-digit"
    });
  }
  const d = new Date(ts);
  if (isNaN(d)) return String(ts);
  return d.toLocaleString("ar-EG", {
    year: "numeric", month: "long", day: "numeric",
    hour: "2-digit", minute: "2-digit"
  });
}

async function loadReasons() {
  try {
    const q = query(collection(db, "reasons"), orderBy("updated_at", "desc"));
    const snap = await getDocs(q);

    if (snap.empty) {
      box.innerHTML = "<p style='text-align:center;'>لا توجد أسباب مسجلة.</p>";
      return;
    }

    let html = "";
    snap.forEach(doc => {
      const r = doc.data();
      html += `
        <div class="item">
          <p><strong>السبب:</strong> ${r.text || "—"}</p>
          <small><strong>آخر تحديث:</strong> ${formatDateMaybe(r.updated_at)}</small>
        </div>
      `;
    });

    box.innerHTML = html;

  } catch (err) {
    box.innerHTML = "<p style='color:#ff8080; text-align:center;'>⚠ خطأ في الاتصال بقاعدة البيانات</p>";
    console.error(err);
  }
}

loadReasons();
</script>

</body>
</html>
